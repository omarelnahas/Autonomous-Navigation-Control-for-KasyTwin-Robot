<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="kasytwin_robot">
    <!-- Support Arm Link (Horizontal) -->
    <link name="lidar_arm">
    <inertial>
        <mass value="0.2"/>
        <origin xyz="0.305 0 0" rpy="0 0 0"/>  <!-- Center of horizontal arm -->
        <inertia ixx="0.0001" ixy="0" ixz="0"
                iyy="0.001" iyz="0"
                izz="0.001"/>
    </inertial>
    
    <visual>
        <origin xyz="0.305 0 0" rpy="0 0 0"/>  <!-- Center at half length -->
        <geometry>
        <box size="0.61 0.03 0.03"/>  <!-- Horizontal: length x width x height -->
        </geometry>
        <material name="gray">
        <color rgba="0.5 0.5 0.5 1"/>
        </material>
    </visual>
    
    <collision>
        <origin xyz="0.305 0 0" rpy="0 0 0"/>
        <geometry>
        <box size="0.61 0.03 0.03"/>
        </geometry>
    </collision>
    </link>

    <!-- Joint connecting arm to base_link -->
    <joint name="lidar_arm_joint" type="fixed">
    <parent link="base_link"/>
    <child link="lidar_arm"/>
    <origin xyz="0 0 0.20" rpy="0 0 0"/>  <!-- 20cm above base -->
    </joint>

    <!-- Lidar Link -->
    <link name="lidar_link">
    <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia ixx="0.0001" ixy="0" ixz="0"
                iyy="0.0001" iyz="0"
                izz="0.0001"/>
    </inertial>
    
    <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
        <cylinder radius="0.05" length="0.07"/>
        </geometry>
        <material name="black">
        <color rgba="0.1 0.1 0.1 1"/>
        </material>
    </visual>
    
    <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
        <cylinder radius="0.05" length="0.07"/>
        </geometry>
    </collision>
    </link>

    <!-- Joint connecting lidar to end of arm -->
    <joint name="lidar_joint" type="fixed">
    <parent link="lidar_arm"/>
    <child link="lidar_link"/>
    <origin xyz="0.61 0 0" rpy="0 0 0"/>  <!-- At the end of 61cm arm -->
    </joint>

    <!-- Gazebo sensor -->
    <gazebo reference="lidar_link">
    <sensor name='gpu_lidar' type='gpu_lidar'>
        <topic>lidar</topic>
        <update_rate>10</update_rate>
        <ray>
        <scan>
            <horizontal>
            <samples>36</samples>
            <resolution>1</resolution>
            <min_angle>-3.14</min_angle>
            <max_angle>3.14</max_angle>
            </horizontal>
        </scan>
        <range>
            <min>0.08</min>
            <max>10.00</max>
            <resolution>0.01</resolution>
        </range>
        </ray>
        <plugin
        filename="libignition-gazebo-sensors-system.so"
        name="ignition::gazebo::systems::Sensors">
        <render_engine>ogre2</render_engine>
        </plugin>
        <always_on>1</always_on>
        <visualize>true</visualize>
    </sensor>
    </gazebo>

    <!-- IMU sensor plugin -->
    <gazebo reference="base_link">
        <sensor name="imu_sensor" type="imu">
            <always_on>1</always_on>
            <update_rate>50</update_rate>
            <visualize>true</visualize>
            <topic>imu</topic>
            <plugin filename="libignition-gazebo-imu-system.so"  name="ignition::gazebo::systems::Imu">
            </plugin>
        </sensor>
    </gazebo>
</robot>
